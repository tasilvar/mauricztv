jQuery(document).ready((function(e){const i={init:function(){i.listeners.invoiceTypeChecker(),i.listeners.nipValidator(),i.listeners.getDataByNip()},listeners:{invoiceTypeChecker:function(){e(document).on("change","select[name=bpmj_edd_invoice_data_invoice_type]",(function(){e("#message_invalid_nip_format").hide()}))},nipValidator:function(){e(document).on("keyup change","#bpmj_edd_invoice_data_invoice_nip",(function(){let i=e(this).val().replace(/[^0-9a-zA-z]/g,"");e(this).val(i)}))},getDataByNip:function(){e(document).on("click","#billing-nip-check",(function(n){n.preventDefault();const t=e("#bpmj_edd_invoice_data_invoice_nip").val(),o=e("#billing-nip-check"),_=e("#message_invalid_nip_format");if(!i.functions.validateNip(t))return _.html(BPMJ_WPI_GUS_API_I18N.wrong_tax_id),void _.show();e.ajax({type:"POST",data:{nip:t,subscription_type:BPMJ_WPI_GUS_API_I18N.subscription_type,subscription_key:BPMJ_WPI_GUS_API_I18N.subscription_key,host:BPMJ_WPI_GUS_API_I18N.host},url:BPMJ_WPI_GUS_API_I18N.search_data_endpoint,beforeSend:function(){o.prop("disabled",!0),o.html(BPMJ_WPI_GUS_API_I18N.downloading)},complete:function(){o.prop("disabled",!1),e("#billing-nip-check").html(BPMJ_WPI_GUS_API_I18N.download_from_gus)},success:function(e){_.hide();let n=i.functions.parseXmlToArray(e);if(n.error_code){let e="8"===n.error_code?BPMJ_WPI_GUS_API_I18N.wrong_tax_id:BPMJ_WPI_GUS_API_I18N.entity_not_found;return _.html(e),void _.show()}i.functions.setDataForInvoiceFields(n)},error:function(e,i,n){200!==e.status&&(_.html(BPMJ_WPI_GUS_API_I18N.error_processing_request),_.show())}})}))}},functions:{validateNip:function(e){return!!new RegExp("[0-9a-zA-z]").test(e)},setDataForInvoiceFields:function(i){e("#bpmj_edd_invoice_data_invoice_company_name").val(i.company_name),e("#bpmj_edd_invoice_data_invoice_street").val(i.street),e("#bpmj_edd_invoice_data_invoice_postcode").val(i.postal_code),e("#bpmj_edd_invoice_data_invoice_city").val(i.city)},parseXmlToArray:function(i){let n=e.parseXML(i),t=e(n),o=t.find("NrLokalu").text(),_=t.find("NrNieruchomosci").text(),c="";o&&(c=" / "+o);let a=t.find("Ulica").text()+" "+_+c;return{error_code:t.find("ErrorCode").text(),company_name:t.find("Nazwa").text(),street:a,postal_code:t.find("KodPocztowy").text(),city:t.find("Miejscowosc").text()}}}};i.init()}));